# Description: Kernel module utilities and library
# URL: https://git.kernel.org/?p=utils/kernel/kmod/kmod.git
# Maintainer: CRUX compat-32 Team, compat-32-ports at crux dot nu
# Depends on: kmod openssl-32 zstd-32

name=kmod-32
version=34.2
release=1
source=(https://www.kernel.org/pub/linux/utils/kernel/${name%-*}/${name%-*}-$version.tar.xz)

build() {
	meson setup build kmod-$version \
		--prefix=/usr \
		--bindir=/bin \
		--sbindir=/sbin \
		--sysconfdir=/etc \
		--libdir=lib32 \
		--buildtype=plain \
		--wrap-mode=nodownload \
		-D b_lto=true \
		-D b_pie=true \
		-D dlopen=all \
		-D docs=false \
		-D manpages=false \
		-D bashcompletiondir=no \
		-D fishcompletiondir=no \
		-D zshcompletiondir=no

	meson compile -C build -j ${JOBS:-1}
	DESTDIR=$PKG meson install -C build

	rm -r $PKG/{bin,etc,sbin} $PKG/usr/{include,share}
}
