# Description: Systemd is a system and service manager for Linux, compatible with SysV and LSB init scripts. Systemd provides: Aggressive parallelization capabilities. Uses socket and D-Bus activation for starting services.
# URL:      https://github.com/systemd/    
# Maintainer:  B.r.i.a.n M.a.d.o.n.n.a b.m.a.d.o.n.n.a.s.t.e.r @ g.m.a.i.l.c.o.m
# Depends on:  linux-pam polkit
# Optional:	btrfs-progs curl cryptsetup git gnutls iptables libgcrypt libidn2 libpwquality libseccomp libxkbcommon make-cap11-kit pcre2 qemu qrencode rsync sphinx valgrind zsh (for the zsh AppArmor, audit-userspace jekyll kexec-tools libbpf libdw libfido2 libmicrohttpd lz4 pyelftools quota-tools rpm selinux systemtap tpm2-tss xen docbook-xml docbook-xsl-nons libxslt lxml

name=systemd
version=256.4
release=2
source=(https://github.com/$name/$name/archive/v$version/$name-$version.tar.gz
https://anduin.linuxfromscratch.org/LFS/$name-man-pages-$version.tar.xz)

pkg_build() {

	sed -i -e 's/GROUP="render"/GROUP="video"/' \
       -e 's/GROUP="sgx", //' rules.d/50-udev-default.rules.in
	sed -e '/return FLAGS_SET.*AUTHENTICATED/s/(t/(dt/' \
    	-i src/resolve/resolved-dns-transaction.c

mkdir build &&
cd    build &&

meson setup ..                \
#      --prefix=/usr           \
      --buildtype=release     \
      -Ddefault-dnssec=no     \
      -Dfirstboot=false       \
      -Dinstall-tests=false   \
      -Dldconfig=false        \
      -Dman=auto              \
      -Dsysusers=false        \
      -Drpmmacrosdir=no       \
      -Dhomed=disabled        \
      -Duserdb=false          \
      -Dmode=release          \
      -Dpam=enabled           \
      -Dpamconfdir=/etc/pam.d \
      -Ddev-kvm-mode=0660     \
      -Dnobody-group=nogroup  \
      -Dsysupdate=disabled    \
      -Dukify=disabled        \
      -Dshared=enabled	      \
      -Ddocdir=/usr/share/doc/$name-$version &&

ninja

      DESTDIR=$PKG ninja install
mkdir -p $PKG/usr/share/man
tar -xf $PKGMK_SOURCE_DIR/systemd-man-pages-$version.tar.xz \
    --no-same-owner --strip-components=1   \
    -C $PKG/usr/share/man
}
